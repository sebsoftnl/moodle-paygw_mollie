{"version":3,"file":"startpayment.min.js","sources":["../src/startpayment.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Payment implementation for mollie system.\n *\n * @package    paygw_mollie\n * @module     paygw_mollie/startpayment\n * @copyright  2021 Ing. R.J. van Dongen <rogier@sebsoft.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from 'paygw_mollie/repository';\nimport * as Notification from 'core/notification';\nimport * as str from 'core/str';\n\n/**\n * Detect selected payment method (if we have one).\n *\n * @returns {String|null}\n */\nfunction getSelectedPaymentMethod() {\n    let el = document.querySelector('input[name=\"method\"][type=\"radio\"]:checked');\n    if (typeof el !== 'undefined' && el !== null) {\n        return el.value;\n    }\n    return null;\n}\n\n/**\n * Create payment in the backend and redirect.\n *\n * @param {String} selector\n * @returns {Promise}\n */\nexport const startPayment = (selector) => {\n    document.querySelector(selector).addEventListener('click', e => {\n        e.preventDefault();\n        const dataset = e.currentTarget.dataset;\n\n        Repository.createPayment(\n                dataset.component,\n                dataset.paymentarea,\n                dataset.itemid,\n                dataset.description,\n                getSelectedPaymentMethod(),\n                null,\n        ).then(result => {\n            if (result.success) {\n                window.location.href = result.redirecturl;\n            } else {\n                str.get_strings([\n                        {key: 'startpayment:failed:title', component: 'paygw_mollie'},\n                        {key: 'startpayment:failed:btncancel', component: 'paygw_mollie'},\n                ]).then(strings => {\n                    Notification.alert(strings[0], result.message, strings[1]);\n                });\n            }\n            return Promise.resolve();\n        }).fail(Notification.exception);\n    });\n};\n"],"names":["selector","document","querySelector","addEventListener","e","preventDefault","dataset","currentTarget","Repository","createPayment","component","paymentarea","itemid","description","el","value","getSelectedPaymentMethod","then","result","success","window","location","href","redirecturl","str","get_strings","key","strings","Notification","alert","message","Promise","resolve","fail","exception"],"mappings":";;;;;;;;mPA+C6BA,WACzBC,SAASC,cAAcF,UAAUG,iBAAiB,SAASC,IACvDA,EAAEC,uBACIC,QAAUF,EAAEG,cAAcD,QAEhCE,WAAWC,cACHH,QAAQI,UACRJ,QAAQK,YACRL,QAAQM,OACRN,QAAQO,2BAtBhBC,GAAKb,SAASC,cAAc,qDAC5B,MAAOY,GACAA,GAAGC,MAEP,KAmBKC,GACA,MACNC,MAAKC,SACCA,OAAOC,QACPC,OAAOC,SAASC,KAAOJ,OAAOK,YAE9BC,IAAIC,YAAY,CACR,CAACC,IAAK,4BAA6BhB,UAAW,gBAC9C,CAACgB,IAAK,gCAAiChB,UAAW,kBACvDO,MAAKU,UACJC,aAAaC,MAAMF,QAAQ,GAAIT,OAAOY,QAASH,QAAQ,OAGxDI,QAAQC,aAChBC,KAAKL,aAAaM"}